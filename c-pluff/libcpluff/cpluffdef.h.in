/*-------------------------------------------------------------------------
 * C-Pluff, a plug-in framework for C
 * Copyright 2006 Johannes Lehtinen
 *-----------------------------------------------------------------------*/

/** @file
 * Common defines shared by C-Pluff C and C++ core APIs.
 * This file is automatically included by the top level C and C++
 * API header files. There should be no need to include it explicitly.
 */

#ifndef CPLUFFDEF_H_
#define CPLUFFDEF_H_


/* ------------------------------------------------------------------------
 * Symbol visibility
 * ----------------------------------------------------------------------*/

/**
 * @defgroup symbolVisibility Symbol visibility
 * @ingroup defines
 *
 * Macros for controlling inter-module symbol visibility and linkage. These
 * macros have platform specific values. #CP_EXPORT, #CP_IMPORT and #CP_HIDE
 * can be reused by plug-in implementations for better portability while
 * #CP_API is framework implementation specific. The complexity is mostly due
 * to Windows DLL exports and imports.
 */
/*@{*/

/**
 * @def CP_EXPORT
 *
 * Declares a symbol to be exported for inter-module usage. When compiling the
 * module which defines the symbol this macro should be placed
 * at the start of the symbol declaration to ensure that the symbol is exported
 * to other modules. However, when compiling other modules the declaration of
 * the symbol should start with #CP_IMPORT. #CP_API provides an example of how
 * to do this.
 */

/**
 * @def CP_IMPORT
 *
 * Declares a symbol to be imported from another module. When compiling a
 * module which uses the symbol this macro should be placed at the start of
 * the symbol declaration to ensure that the symbol is imported from the
 * defining module. However, when compiling the defining module the declaration
 * of the symbol should start with #CP_EXPORT. #CP_API provides an example of
 * how to do this.
 */

/**
 * @def CP_HIDDEN
 *
 * Declares a symbol hidden from other modules. This macro should be
 * placed at the start of the symbol declaration to hide the symbol from other
 * modules (if supported by the platform). This macro is not intended to be
 * used with symbols declared as "static" which are already internal to the
 * object file. Some platforms do not support hiding of symbols and therefore
 * unique prefixes should be used for global symbols internal to the module
 * even when they are declared using this macro.
 */

#if defined(_WIN32)
#  define CP_EXPORT __declspec(dllexport)
#  define CP_IMPORT extern __declspec(dllimport)
#  define CP_HIDDEN
#elif defined(__GNUC__) && (__GNUC__ > 3 || (__GNUC__ == 3 && __GNUC_MINOR__ >= 3))
#  define CP_EXPORT
#  define CP_IMPORT extern
#  define CP_HIDDEN __attribute__ ((visibility ("hidden")))
#else
#  define CP_EXPORT
#  define CP_IMPORT extern
#  define CP_HIDDEN
#endif

/**
 * @def CP_API
 *
 * Marks a symbol declaration to be part of the C-Pluff framework API.
 * This macro can not be reused by plug-in implementations. A plug-in
 * implementation should instead define a macro for declaring its own
 * API symbols.
 *
 * Here is an example of how to define a corresponding macro for use by a
 * plug-in implementation. The example assumes that
 * the preprocessor symbol MY_BUILD is defined when building the module which
 * uses MY_API macro to declare API symbols (symbols for inter-module usage).
 *
 * @code
 * #include <cpluff.h>
 * #if defined(MY_BUILD)
 * #  define MY_API CP_EXPORT
 * #else
 * #  define MY_API CP_IMPORT
 * #endif
 * @endcode
 */

#if defined(CP_BUILD)
#  define CP_API CP_EXPORT
#else
#  define CP_API CP_IMPORT
#endif

/*@}*/


/* ------------------------------------------------------------------------
 * Version information
 * ----------------------------------------------------------------------*/

/**
 * @defgroup versionInfo Version information
 * @ingroup defines
 *
 * C-Pluff core version information. Notice that this version information
 * is static version information included in header files and can therefore
 * only be used for compile time checks. Corresponding runtime information can
 * be queried using ::cp_get_core_info.
 */
/*@{*/

/**
 * The C-Pluff release version string. This is the version of the C-Pluff
 * release providing the core facilities. Release version identifies a specific
 * version of the C-Pluff distribution and it is intended to be used by people.
 * Software should use the API version information for compatibility checks.
 */
#define CP_RELEASE_VERSION "@PACKAGE_VERSION@"

/**
 * The current version of the core C/C++ API. This is an integer number telling
 * the current version of the core API. It is incremented whenever there have
 * been changes to API interfaces.
 */
#define CP_CORE_API_VERSION @CP_CORE_API_CURRENT@

/**
 * The revision of the core C/C++ API. This is an integer number telling
 * the revision number of the current implementation. It is resetted to zero
 * for each new API version and incremented when only the implementation
 * changes but API interfaces remain the same.
 */
#define CP_CORE_API_REVISION @CP_CORE_API_REVISION@

/**
 * The backwards compatibility age of the core C/C++ API. This integer
 * number tells the backward compatibility age of the current
 * API. Subtracting the age from the current API version gives the earliest
 * backwards compatible API version. Software written for a backward
 * compatible API version should work with the current version but not
 * vice versa. The age is incremented together with the current API version
 * when new interfaces are added and it is resetted to zero if any interfaces
 * are removed or changed.
 */
#define CP_CORE_API_AGE @CP_CORE_API_AGE@

/*@}*/


#endif /*CPLUFFDEF_H_*/
